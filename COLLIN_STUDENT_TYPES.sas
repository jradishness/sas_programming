******************************************
PROGRAM TO REPORT FREQUENCY OF STUDENT
TYPES ACROSS 2 SEMESTERS.

IN OTHER WORDS, FALL 2019 ACROSS THE Y
AXIS, SPRING 2020 ACROSS THE X AXIS, WITH
FREQUENCIES OF STUDENT TYPES (CHEC, CHEC+,
COLLIN, COLLIN+, ETC.)
*****************************************;
*      STUDENT_TYPE(S20, ENROLLMENT) ;
*      STUDENT_TYPE(F19, "C:\Users\jrk0200\UNT System\Clark, Allen - FriscoEnrollment\EnrollmentRecords\enrollement_dw_2019z_census") ;

********* CREATING STUDENT LISTS ****************;
%let SEMESTER1 = "C:\Users\jrk0200\UNT System\Clark, Allen - FriscoEnrollment\EnrollmentRecords\enrollement_dw_2019z_census";
%let SEMESTER2 = "C:\Users\jrk0200\UNT System\Clark, Allen - FriscoEnrollment\EnrollmentRecords\enrollement_dw_2020c_2census_dt";
DATA COLLIN_STUDENTS_F19;		*load the (Collin) enrollment from the first semester, removing all fields except emplid, return list of ids;
	SET &SEMESTER1;
	WHERE LOCATION IN ('FRSC', 'Z-CHEC', 'Z-INSPK');
	KEEP EMPLID;
RUN;
PROC SORT DATA=COLLIN_STUDENTS_F19 NODUPKEY;		* Remove duplicates to return true list of Collin students;
	BY EMPLID;
RUN;
DATA COLLIN_STUDENTS_S20;		* LOAD THE COLLIN ENROLLMENT FROM THE SECOND SEMESTER, REMOVING ALL BUT EMPLID, RETURN LIST OF STUDENT IDS;
	SET &SEMESTER2;
	WHERE LOCATION IN ('FRSC', 'Z-CHEC', 'Z-INSPK');
	KEEP EMPLID;
RUN;
PROC SORT DATA=COLLIN_STUDENTS_S20 NODUPKEY;		* Remove duplicates to return true list of Collin students;
	BY EMPLID;
RUN;
DATA COLLIN_STUDENTS_FY19;	*MERGE THE TWO STUDENT SETS INTO ONE;
	MERGE COLLIN_STUDENTS_F19 COLLIN_STUDENTS_S20;
	BY EMPLID;
RUN;
PROC SORT DATA=COLLIN_STUDENTS_FY19 NODUPKEY;		* Remove duplicates to return true list of Collin students;
	BY EMPLID;
RUN;

************** QUERY AND PROCESS SEMESTER 1 **************************;
PROC SORT DATA=&SEMESTER1 OUT=ENROLL_TEMP1;
	BY EMPLID;		* This recreates the enrollment report we just finished filtering out of;
RUN;
PROC SORT DATA=&SEMESTER2 OUT=ENROLL_TEMP2;
	BY EMPLID;
RUN;
DATA ENROLL_TEMP;
	SET ENROLL_TEMP1 ENROLL_TEMP2;
RUN;
PROC SORT DATA=ENROLL_TEMP;
	BY EMPLID;
RUN;

DATA COL_STUD_ENROLL_F19;			* Create a dataset with the intersection of enrollment and the Collin student list, return an emplid and loc for each enrollment;
	MERGE ENROLL_TEMP COLLIN_STUDENTS_FY19(IN=A);
	BY EMPLID;
	IF A=1;
	KEEP EMPLID LOCATION;
RUN;
DATA FRISCO_F19;		*Create dataset for all HP enrollments;
	SET COL_STUD_ENROLL_F19;
	WHERE LOCATION = "FRSC";
	FRISCO = 1;
	KEEP EMPLID FRISCO;
RUN;
PROC SORT DATA=FRISCO_F19 NODUPKEY;		* remove any duplicates (we don't need all the enrollments of a location, just 1 per id, so we know they qualify);
	BY EMPLID;
RUN;
DATA MAIN_F19;	*Create dataset for all main enrollments;
	SET COL_STUD_ENROLL_F19;
	WHERE LOCATION = "MAIN";
	MAIN = 1;
	KEEP EMPLID MAIN;
RUN;
PROC SORT DATA=MAIN_F19 NODUPKEY;		* remove any duplicates (we don't need all the enrollments of a location, just 1 per id, so we know they qualify);
	BY EMPLID;
RUN;
DATA AOP_F19;	*Create dataset for all AOP enrollments;
	SET COL_STUD_ENROLL_F19;
	WHERE LOCATION = "Z-AOP";
	AOP = 1;
	KEEP EMPLID AOP;
RUN;
PROC SORT DATA=AOP_F19 NODUPKEY;		* remove any duplicates (we don't need all the enrollments of a location, just 1 per id, so we know they qualify);
	BY EMPLID;
RUN;
DATA CHEC_F19;	*Create dataset for all CHEC enrollments;
	SET COL_STUD_ENROLL_F19;
	WHERE LOCATION = "Z-CHEC";
	CHEC = 1;
	KEEP EMPLID CHEC;
RUN;
PROC SORT DATA=CHEC_F19 NODUPKEY;		* remove any duplicates (we don't need all the enrollments of a location, just 1 per id, so we know they qualify);
	BY EMPLID;
RUN;
DATA INET_F19;	*Create dataset for all Internet enrollments;
	SET COL_STUD_ENROLL_F19;
	WHERE LOCATION = "Z-INET-TX";
	INET = 1;
	KEEP EMPLID INET;
RUN;
PROC SORT DATA=INET_F19 NODUPKEY;		* remove any duplicates (we don't need all the enrollments of a location, just 1 per id, so we know they qualify);
	BY EMPLID;
RUN;
DATA INSPK_F19;	*Create dataset for all IP enrollments;
	SET COL_STUD_ENROLL_F19;
	WHERE LOCATION = "Z-INSPK";
	INSPK = 1;
	KEEP EMPLID INSPK;
RUN;
PROC SORT DATA=INSPK_F19 NODUPKEY;		* remove any duplicates (we don't need all the enrollments of a location, just 1 per id, so we know they qualify);
	BY EMPLID;
RUN;
DATA COUNTS_F19;		* Merge into a single dataset for classification;
	MERGE INSPK_F19 FRISCO_F19 CHEC_F19 MAIN_F19 AOP_F19 INET_F19;
	BY EMPLID;
RUN;
DATA COUNTS_F19;		* based on all of the new variables, create a type variable (FALL_2019) for all relevant combinations;
	SET COUNTS_F19;
	IF INSPK=1 AND FRISCO="" AND CHEC="" AND MAIN="" AND INET="" THEN FALL_2019 = "IP ONLY";
	ELSE IF INSPK=1 AND FRISCO="" AND CHEC="" AND MAIN="" AND INET=1 THEN FALL_2019 = "IP+";
	ELSE IF INSPK="" AND FRISCO=1 AND CHEC="" AND MAIN="" AND INET="" THEN FALL_2019 = "HP ONLY";
	ELSE IF INSPK="" AND FRISCO=1 AND CHEC="" AND MAIN="" AND INET=1 THEN FALL_2019 = "HP+";
	ELSE IF INSPK="" AND FRISCO="" AND CHEC=1 AND MAIN="" AND INET="" THEN FALL_2019 = "CHEC";
	ELSE IF INSPK="" AND FRISCO="" AND CHEC=1 AND MAIN="" AND INET=1 THEN FALL_2019 = "CHEC+";
	ELSE IF INSPK=1 AND FRISCO=1 AND CHEC="" AND MAIN="" AND INET="" THEN FALL_2019 = "FRISCO";
	ELSE IF INSPK=1 AND FRISCO=1 AND CHEC="" AND MAIN="" AND INET=1 THEN FALL_2019 = "FRISCO+";
	ELSE IF (INSPK=1 OR FRISCO=1) AND CHEC=1 AND MAIN="" AND INET="" THEN FALL_2019 = "COLLIN";
	ELSE IF (INSPK=1 OR FRISCO=1) AND CHEC=1 AND MAIN="" AND INET=1 THEN FALL_2019 = "COLLIN+";
	ELSE IF MAIN=1 AND (INSPK=1 OR FRISCO=1 OR CHEC=1) THEN FALL_2019 = "MAIN";
	ELSE IF (INSPK=1 OR FRISCO=1 OR CHEC=1) AND MAIN=1 AND INET=1 THEN SPRING_2020 = "MAIN+";
	*ELSE IF AOP=1 THEN FALL_2019="AOP";
	*ELSE FALL_2019 = "NONE";
	KEEP EMPLID FALL_2019;
RUN;

/* steps for debugging
TITLE1 "FALL 2019";
PROC FREQ DATA=COUNTS_F19;
	TABLE FALL_2019;
RUN;
PROC PRINT DATA=COUNTS_F19;
	WHERE FALL_2019 = "NONE";
RUN;
TITLE;
*/
*      STUDENT_TYPE(S20, ENROLLMENT) ;
*      STUDENT_TYPE(F19, "C:\Users\jrk0200\UNT System\Clark, Allen - FriscoEnrollment\EnrollmentRecords\enrollement_dw_2019z_census") ;

************** QUERY AND PROCESS SEMESTER 2 **************************;
/* second verse, same as the first;
PROC SORT DATA="C:\Users\jrk0200\UNT System\Clark, Allen - FriscoEnrollment\EnrollmentRecords\enrollement_dw_2020c_2census_dt" OUT=ENROLL_TEMP;
	BY EMPLID;
RUN;
DATA COL_STUD_ENROLL_S20;				* SEM 2 ENROLLMENT OF FRISCO STUDENTS;
	MERGE ENROLL_TEMP COLLIN_STUDENTS_FY19(IN=A);
	BY EMPLID;
	IF A=1;
	KEEP EMPLID LOCATION;
RUN;
DATA FRISCO_S20;
	SET COL_STUD_ENROLL_S20;
	WHERE LOCATION = "FRSC";
	FRISCO = 1;
	KEEP EMPLID FRISCO;
RUN;
PROC SORT DATA=FRISCO_S20 NODUPKEY;
	BY EMPLID;
RUN;
DATA MAIN_S20;
	SET COL_STUD_ENROLL_S20;
	WHERE LOCATION = "MAIN";
	MAIN = 1;
	KEEP EMPLID MAIN;
RUN;
PROC SORT DATA=MAIN_S20 NODUPKEY;
	BY EMPLID;
RUN;
DATA AOP_S20;
	SET COL_STUD_ENROLL_S20;
	WHERE LOCATION = "Z-AOP";
	AOP = 1;
	KEEP EMPLID AOP;
RUN;
PROC SORT DATA=AOP_S20 NODUPKEY;
	BY EMPLID;
RUN;
DATA CHEC_S20;
	SET COL_STUD_ENROLL_S20;
	WHERE LOCATION = "Z-CHEC";
	CHEC = 1;
	KEEP EMPLID CHEC;
RUN;
PROC SORT DATA=CHEC_S20 NODUPKEY;
	BY EMPLID;
RUN;
DATA INET_S20;
	SET COL_STUD_ENROLL_S20;
	WHERE LOCATION = "Z-INET-TX";
	INET = 1;
	KEEP EMPLID INET;
RUN;
PROC SORT DATA=INET_S20 NODUPKEY;
	BY EMPLID;
RUN;
DATA INSPK_S20;
	SET COL_STUD_ENROLL_S20;
	WHERE LOCATION = "Z-INSPK";
	INSPK = 1;
	KEEP EMPLID INSPK;
RUN;
PROC SORT DATA=INSPK_S20 NODUPKEY;
	BY EMPLID;
RUN;
DATA COUNTS_S20;
	MERGE INSPK_S20 FRISCO_S20 CHEC_S20 MAIN_S20 AOP_S20 INET_S20;
	BY EMPLID;
RUN;
DATA COUNTS_S20;
	SET COUNTS_S20;
	IF INET=1 AND INSPK="" AND FRISCO="" AND CHEC="" AND MAIN="" THEN SPRING_2020 = "INTERNET ONLY";
	ELSE IF INSPK=1 AND FRISCO="" AND CHEC="" AND MAIN="" AND INET="" THEN SPRING_2020 = "IP ONLY";
	ELSE IF INSPK=1 AND FRISCO="" AND CHEC="" AND MAIN="" AND INET=1 THEN SPRING_2020 = "IP+";
	ELSE IF INSPK="" AND FRISCO=1 AND CHEC="" AND MAIN="" AND INET="" THEN SPRING_2020 = "HP ONLY";
	ELSE IF INSPK="" AND FRISCO=1 AND CHEC="" AND MAIN="" AND INET=1 THEN SPRING_2020 = "HP+";
	ELSE IF INSPK="" AND FRISCO="" AND CHEC=1 AND MAIN="" AND INET="" THEN SPRING_2020 = "CHEC";
	ELSE IF INSPK="" AND FRISCO="" AND CHEC=1 AND MAIN="" AND INET=1 THEN SPRING_2020 = "CHEC+";
	ELSE IF INSPK=1 AND FRISCO=1 AND CHEC="" AND MAIN="" AND INET="" THEN SPRING_2020 = "FRISCO";
	ELSE IF INSPK=1 AND FRISCO=1 AND CHEC="" AND MAIN="" AND INET=1 THEN SPRING_2020 = "FRISCO+";
	ELSE IF (INSPK=1 OR FRISCO=1) AND CHEC=1 AND MAIN="" AND INET="" THEN SPRING_2020 = "COLLIN";
	ELSE IF (INSPK=1 OR FRISCO=1) AND CHEC=1 AND MAIN="" AND INET=1 THEN SPRING_2020 = "COLLIN+";
	ELSE IF (INSPK=1 OR FRISCO=1 OR CHEC=1) AND MAIN=1 THEN SPRING_2020 = "MAIN";
	ELSE IF (INSPK=1 OR FRISCO=1 OR CHEC=1) AND MAIN=1 AND INET=1 THEN SPRING_2020 = "MAIN+";
	*ELSE IF MAIN=1 THEN SPRING_2020 = "MAIN ONLY";
	*ELSE IF AOP=1 THEN SPRING_2020="AOP ONLY";
	*ELSE SPRING_2020 = "NONE";
	KEEP EMPLID SPRING_2020;
RUN;
/* steps for debugging
TITLE1 "SPRING 2020";
PROC FREQ DATA=COUNTS_S20;
	TABLE SPRING_2020;
RUN;

PROC PRINT DATA=COUNTS_S20;
	WHERE SPRING_2020 = "NONE";
RUN;
TITLE;


* FINAL STEP IN PROCESSING THE TWO DATASETS;
DATA FINAL_CTS;
	MERGE COLLIN_STUDENTS_FY19(IN=A) COUNTS_F19 COUNTS_S20;
	BY EMPLID;
	IF A=1;
RUN;
DATA FINAL_CTS;
	SET FINAL_CTS;
	IF SPRING_2020 = "" THEN SPRING_2020 = "UNENROLLED";
	IF FALL_2019 = "" THEN FALL_2019 = "UNENROLLED";
RUN;
*/

TITLE1 "Frequency of Collin Student types the last two semesters.";
TITLE2 "ALL STUDENTS IN THIS PROC CHART TOUCHED COLLIN";
PROC FREQ DATA=COUNTS_F19 ORDER=FREQ;
	*WHERE FALL_2019 IN ("IP ONLY", "IP+", "HP ONLY", "HP+","CHEC", "CHEC+","FRISCO","FRISCO+","COLLIN","COLLIN+", "MAIN", "MAIN+");
	TABLE FALL_2019/NOPERCENT;
RUN;
